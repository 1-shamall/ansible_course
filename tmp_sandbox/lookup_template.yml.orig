---
- hosts: cisco
  vars:
    creds:
        host: "{{ ansible_host }}"
        username: "{{ username }}"
        password: "{{ password }}"
    creds_napalm:
        host: "{{ ansible_host }}"
        username: "{{ username }}"
        password: "{{ password }}"
        dev_os: ios

  tasks:
    - ios_command: 
        provider: "{{ creds }}"
        commands: show arp
      register: show_arp

    - name: Print show arp to screen
      debug:
        msg: "{{ show_arp.stdout[0].splitlines() }}"

    - set_fact:
        arp_lines: "{{ show_arp.stdout[0].splitlines() }}"

    - name: Process through template lookup
      debug:
        msg: "{{ lookup('template', './show_version.j2') }}"

    - napalm_get_facts:
        provider: "{{ creds_napalm }}"
        filter: "arp_table"

    - name: Convert napalm data structure
      debug:
        msg: "{{ lookup('template', './convert_napalm_arp.j2') | from_yaml }}"

    - set_fact:
        new_arp: "{{ lookup('template', './convert_napalm_arp.j2') | from_yaml }}"

    - debug:
        var: new_arp['10.220.88.1']

- hosts: pynet-sw8
  vars:
    creds_napalm:
        host: "{{ ansible_host }}"
        username: "{{ username }}"
        password: "{{ password }}"
        dev_os: eos
  tasks:
    - napalm_get_facts:
        provider: "{{ creds_napalm }}"
        filter: "mac_address_table"

    - name: Convert napalm data structure
      debug:
        msg: "{{ lookup('template', './convert_napalm_mac_table.j2') | from_yaml }}"

    - name: Try to print out interface that gateway mac is seen on
      set_fact:
        new_mac_table: "{{ lookup('template', './convert_napalm_mac_table.j2') | from_yaml }}"

    - name: Try to print out interface that gateway mac is seen on
      debug:
        var: new_mac_table["00:62:EC:29:70:FE"]

